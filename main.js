(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e,r,n){return(r=function(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var o={baseUrl:"https://nomoreparties.co/v1/",cohort:"wff-cohort-17/",token:"8fcda09a-8f72-4dc5-aa90-849dbf4c62a2"};function c(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=r({method:e,headers:r({authorization:o.token},"GET"!==e?{"Content-Type":"application/json"}:{})},n?{body:JSON.stringify(n)}:{});return fetch(o.baseUrl+o.cohort+t,i).then(c)}function a(t){return i("cards/".concat(t,"/likes"),"DELETE")}function u(t){return i("cards/".concat(t,"/likes"),"PUT")}function l(t){console.log(t)}function s(t,e,r){var n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image");o.src=t.link,o.alt="Фотография "+t.name,o.addEventListener("click",(function(){r(t.name,t.link)})),n.querySelector(".card__title").textContent=t.name;var c=n.querySelector(".card__like-button"),s=n.querySelector(".card__likes-count");s.textContent=t.likes.length,function(t,e){return t.likes.some((function(t){return t._id===e._id}))}(t,e)&&c.classList.add("card__like-button_is-active"),c.addEventListener("click",(function(){(c.classList.contains("card__like-button_is-active")?a:u)(t._id).then((function(t){c.classList.toggle("card__like-button_is-active"),s.textContent=t.likes.length})).catch(l)}));var p=n.querySelector(".card__delete-button");return e._id!==t.owner._id?p.classList.add("card__delete-button_disabled"):p.addEventListener("click",(function(){var e;(e=t._id,i("cards/".concat(e),"DELETE")).then((function(){return n.remove()})).catch(l)})),n}function p(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",v)}function f(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",v)}function d(t){f(t.target.closest(".popup"))}function y(t){t.target===t.currentTarget&&f(t.target)}function v(t){"Escape"===t.key&&f(document.querySelector(".popup_is-opened"))}function m(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(r):e.classList.add(r)}function _(t,e){var r=Array.from(t.querySelectorAll(".".concat(e.inputErrorClass))),n=Array.from(t.querySelectorAll(".".concat(e.errorClass)));r.forEach((function(t){return t.classList.remove(e.inputErrorClass)})),n.forEach((function(t){t.textContent="",t.classList.remove(e.errorClass)}))}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},h=document.querySelector(".profile"),g=document.querySelector(".popup_type_edit"),E=h.querySelector(".profile__edit-button"),q=h.querySelector(".profile__title"),C=h.querySelector(".profile__description"),L=document.forms["edit-profile"],k=h.querySelector(".profile__add-button");function O(t){var e=t.name,r=t.about,n=t.avatar;q.textContent=e,C.textContent=r,x.src=n}L.addEventListener("submit",(function(t){t.preventDefault();var e=t.currentTarget.querySelector(".popup__button");e.textContent="Сохранение...",updateUserInfo({name:L.name.value,about:L.description.value}).then((function(t){return O(t)})).catch(l).finally((function(){return e.textContent="Сохранить"})),f(g)})),E.addEventListener("click",(function(){L.name.value=q.textContent,L.description.value=C.textContent,_(L,S),p(g)}));var j=document.querySelector(".popup_type_avatar"),w=document.forms.avatar,x=h.querySelector(".profile__image");h.querySelector(".profile__image-container").addEventListener("click",(function(){w.reset(),_(w,S),p(j)})),w.addEventListener("submit",(function(t){t.preventDefault();var e,r=t.currentTarget.querySelector(".popup__button");r.textContent="Сохранение...",(e={avatar:w["avatar-link"].value},i("users/me/avatar","PATCH",e)).then((function(t){O(t),f(j)})).catch(l).finally((function(){return r.textContent="Сохранить"}))}));var A,P,T,D,U,B,I,M=document.querySelector(".places__list"),G=document.querySelector(".popup_type_new-card"),N=document.querySelector(".popup_type_image"),V=document.forms["new-place"];function z(t,e){var r=s(t,e,H);M.prepend(r)}function H(t,e){var r=N.querySelector(".popup__image");r.src=e,r.alt="Фотография "+t,N.querySelector(".popup__caption").textContent=t,p(N)}k.addEventListener("click",(function(){V.reset(),_(V,S),p(G)})),V.addEventListener("submit",(function(t){t.preventDefault();var e,r=t.currentTarget.querySelector(".popup__button");r.textContent="Сохранение...",(e={name:V["place-name"].value,link:V.link.value},i("cards","POST",e)).then((function(t){z(t,t.owner),V.reset(),_(V,S),f(G)})).catch(l).finally((function(){return r.textContent="Сохранить"}))})),document.querySelectorAll(".popup").forEach((function(t){t.querySelector("button.popup__close").addEventListener("click",d),t.addEventListener("click",y)})),Promise.all([i("users/me"),i("cards")]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,c,i,a=[],u=!0,l=!1;try{if(c=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=c.call(r)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(e,r)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];O(o),Array.from(c).reverse().forEach((function(t){z(t,o)}))})).catch(l),P=(A=S).formSelector,T=A.inputSelector,D=A.submitButtonSelector,U=A.inactiveButtonClass,B=A.inputErrorClass,I=A.errorClass,Array.from(document.querySelectorAll(P)).forEach((function(t){!function(t,e,r,n,o,c){t.addEventListener("submit",(function(t){return t.preventDefault()}));var i=Array.from(t.querySelectorAll(e)),a=t.querySelector(r);m(i,a,n),i.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,r,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),o.classList.remove(n),o.textContent=""}(t,e,r,n):function(t,e,r,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),c.textContent=r,c.classList.add(o)}(t,e,e.validationMessage,r,n)}(t,e,o,c),m(i,a,n)}))}))}(t,T,D,U,B,I)}))})();